var H=Object.create;var g=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var x=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty;var v=(e,n)=>{for(var r in n)g(e,r,{get:n[r],enumerable:!0})},m=(e,n,r,i)=>{if(n&&typeof n=="object"||typeof n=="function")for(let t of $(n))!R.call(e,t)&&t!==r&&g(e,t,{get:()=>n[t],enumerable:!(i=A(n,t))||i.enumerable});return e};var W=(e,n,r)=>(r=e!=null?H(x(e)):{},m(n||!e||!e.__esModule?g(r,"default",{value:e,enumerable:!0}):r,e)),j=e=>m(g({},"__esModule",{value:!0}),e);var k={};v(k,{jwt:()=>P});module.exports=j(k);var u=W(require("crypto"),1),c=require("ecdsa-sig-formatter"),y=["HS256","HS384","HS512","RS256","RS384","RS512"];function w(e){return y.includes(e)}var h={HS256:d(256),HS384:d(384),HS512:d(512),RS256:l(256),RS384:l(384),RS512:l(512),ES256:E(256)};function d(e){function n(i,t){return u.default.createHmac(`sha${e}`,t).update(i).digest("base64")}function r(i,t,s){return n(i,s)===t}return{sign:n,verify:r}}function l(e){let n=`RSA-SHA${e}`;function r(t,s){return u.default.createSign(n).update(t).sign(s.toString(),"base64")}function i(t,s,a){let o=u.default.createVerify(n);return o.update(t),o.verify(a,s,"base64")}return{sign:r,verify:i}}function E(e){let n=`RSA-SHA${e}`;function r(t,s){let a=u.default.createSign(n).update(t).sign({key:s.toString()},"base64");return(0,c.derToJose)(a,`ES${e}`)}function i(t,s,a){s=(0,c.joseToDer)(s,`ES${e}`).toString("base64");let o=u.default.createVerify(n);return o.update(t),o.verify(a,s,"base64")}return{sign:r,verify:i}}function p(e){let n=JSON.stringify(e);return B(Buffer.from(n).toString("base64"))}function S(e){let n=Buffer.from(b(e),"base64").toString("utf-8");try{return JSON.parse(n)}catch(r){return console.warn("Failed to decode base64 and parse as JSON:",r),n}}function B(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function b(e){e=e.toString();let n=4-e.length%4;if(n!==4)for(let r=0;r<n;r++)e+="=";return e.replace(/\-/g,"+").replace(/_/g,"/")}function V(e,n,r="HS256"){if(!w(r))throw new Error(`${r} is an invalid algorithm type. Must be one of ${y}`);let i=p({alg:r,type:"JWT"}),t=p(e),s=`${i}.${t}`,a=h[r],o=B(a.sign(s,n));return`${s}.${o}`}function J(e){let n=e.split(".");if(n.length!==3)throw new Error(`Decode expected 3 parts to encoded token, got ${n.length}`);let r=S(n[0]),i=S(n[1]),t=Buffer.from(b(n[2]),"base64");return{header:r,payload:i,signature:t}}function O(e,n,r={}){let i=J(e),{payload:t}=i,s=e.split("."),a=r.alg??i.header.alg??"HS256",o=Date.now(),T=h[a],f={decoded:i};return f.sig=T.verify(`${s[0]}.${s[1]}`,b(s[2]),n),t.exp!==void 0&&(f.exp=t.exp<o),t.nbf!==void 0&&(f.nbf=o>=t.nbf),r.iat!==void 0&&(f.iat=t.iat===r.iat),r.iss!==void 0&&(f.iss=t.iss===r.iss),r.jti!==void 0&&(f.jti=t.jti!==r.jti),r.sub!==void 0&&(f.sub=t.sub===r.sub),r.aud!==void 0&&(f.aud=t.aud===r.aud),f}var P={encode:V,decode:J,verify:O};0&&(module.exports={jwt});
