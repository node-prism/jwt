var H=Object.create;var u=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var $=Object.getOwnPropertyNames;var x=Object.getPrototypeOf,R=Object.prototype.hasOwnProperty;var v=(e,r)=>{for(var n in r)u(e,n,{get:r[n],enumerable:!0})},m=(e,r,n,i)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of $(r))!R.call(e,t)&&t!==n&&u(e,t,{get:()=>r[t],enumerable:!(i=A(r,t))||i.enumerable});return e};var W=(e,r,n)=>(n=e!=null?H(x(e)):{},m(r||!e||!e.__esModule?u(n,"default",{value:e,enumerable:!0}):n,e)),j=e=>m(u({},"__esModule",{value:!0}),e);var k={};v(k,{jwt:()=>O});module.exports=j(k);var g=W(require("crypto"),1),c=require("ecdsa-sig-formatter"),S=["HS256","HS384","HS512","RS256","RS384","RS512"];function w(e){return S.includes(e)}var h={HS256:d(256),HS384:d(384),HS512:d(512),RS256:l(256),RS384:l(384),RS512:l(512),ES256:E(256)};function d(e){function r(i,t){return g.default.createHmac(`sha${e}`,t).update(i).digest("base64")}function n(i,t,s){return r(i,s)===t}return{sign:r,verify:n}}function l(e){let r=`RSA-SHA${e}`;function n(t,s){return g.default.createSign(r).update(t).sign(s.toString(),"base64")}function i(t,s,a){let o=g.default.createVerify(r);return o.update(t),o.verify(a,s,"base64")}return{sign:n,verify:i}}function E(e){let r=`RSA-SHA${e}`;function n(t,s){let a=g.default.createSign(r).update(t).sign({key:s.toString()},"base64");return(0,c.derToJose)(a,`ES${e}`)}function i(t,s,a){s=(0,c.joseToDer)(s,`ES${e}`).toString("base64");let o=g.default.createVerify(r);return o.update(t),o.verify(a,s,"base64")}return{sign:n,verify:i}}function p(e){let r=JSON.stringify(e);return B(Buffer.from(r).toString("base64"))}function y(e){let r=Buffer.from(b(e),"base64").toString("utf-8");try{return JSON.parse(r)}catch(n){throw n}}function B(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function b(e){e=e.toString();let r=4-e.length%4;if(r!==4)for(let n=0;n<r;n++)e+="=";return e.replace(/\-/g,"+").replace(/_/g,"/")}function V(e,r,n="HS256"){if(!w(n))throw new Error(`${n} is an invalid algorithm type. Must be one of ${S}`);let i=p({alg:n,type:"JWT"}),t=p(e),s=`${i}.${t}`,a=h[n],o=B(a.sign(s,r));return`${s}.${o}`}function J(e){let r=e.split(".");if(r.length!==3)throw new Error(`Decode expected 3 parts to encoded token, got ${r.length}`);let n=y(r[0]),i=y(r[1]),t=Buffer.from(b(r[2]),"base64");return{header:n,payload:i,signature:t}}function P(e,r,n={}){let i=J(e),{payload:t}=i,s=e.split("."),a=n.alg??i.header.alg??"HS256",o=Date.now(),T=h[a],f={decoded:i};return f.sig=T.verify(`${s[0]}.${s[1]}`,b(s[2]),r),t.exp!==void 0&&(f.exp=t.exp<o),t.nbf!==void 0&&(f.nbf=o>=t.nbf),n.iat!==void 0&&(f.iat=t.iat===n.iat),n.iss!==void 0&&(f.iss=t.iss===n.iss),n.jti!==void 0&&(f.jti=t.jti!==n.jti),n.sub!==void 0&&(f.sub=t.sub===n.sub),n.aud!==void 0&&(f.aud=t.aud===n.aud),f}var O={encode:V,decode:J,verify:P};0&&(module.exports={jwt});
